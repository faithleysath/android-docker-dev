# DockeråŒ–çš„å®‰å“å¼€å‘ç¯å¢ƒ

è¿™æ˜¯ä¸€ä¸ªåŸºäºDockerå®¹å™¨çš„å®‰å“å¼€å‘ç¯å¢ƒï¼Œå¯ä»¥ç”¨äºå¤šä¸ªå®‰å“é¡¹ç›®çš„å¼€å‘ã€‚æ­¤ç¯å¢ƒé¢„è£…äº†JDK 17ã€Kotlinæ”¯æŒå’ŒAndroid SDK 31ï¼ˆå…¼å®¹Android 12ï¼‰ï¼Œå¹¶æ”¯æŒæ— çº¿è°ƒè¯•è¿æ¥åˆ°çœŸå®è®¾å¤‡ã€‚

## ç¯å¢ƒç‰¹ç‚¹

- ğŸ³ å®Œå…¨å®¹å™¨åŒ–ï¼Œé¿å…æ±¡æŸ“ä¸»æœºç³»ç»Ÿ
- ğŸš€ æ”¯æŒå¤šä¸ªé¡¹ç›®å…±äº«åŒä¸€å¼€å‘ç¯å¢ƒ
- ğŸ“± æ”¯æŒæ— çº¿è°ƒè¯•è¿æ¥åˆ°å®é™…è®¾å¤‡
- ğŸ”„ ç¼“å­˜å…±äº«ï¼Œæé«˜æ„å»ºé€Ÿåº¦
- ğŸ› ï¸ ä¸VSCodeé›†æˆï¼Œæä¾›å®Œæ•´çš„IDEä½“éªŒ

## å¼€å§‹ä½¿ç”¨

### åˆæ¬¡å¯åŠ¨

1. ç¡®ä¿å·²å®‰è£…å¹¶å¯åŠ¨ Docker Desktop
2. è¿è¡Œå¯åŠ¨è„šæœ¬ï¼š
   ```bash
   cd ~/android-docker-dev
   ./start-dev-env.sh start
   ```
3. ç­‰å¾…å®¹å™¨å¯åŠ¨å®Œæˆ

### è¿æ¥åˆ°VSCode

1. åœ¨VSCodeä¸­æ‰“å¼€å®‰å“é¡¹ç›®æ‰€åœ¨ç›®å½•ï¼š
   ```bash
   code ~/android-docker-dev
   ```
2. ç‚¹å‡»VSCodeå·¦ä¸‹è§’çš„ç»¿è‰²å›¾æ ‡
3. é€‰æ‹©"åœ¨å®¹å™¨ä¸­é‡æ–°æ‰“å¼€"é€‰é¡¹
4. VSCodeå°†é‡æ–°åŠ è½½å¹¶è¿æ¥åˆ°å¼€å‘å®¹å™¨

### è¿æ¥å®‰å“è®¾å¤‡è¿›è¡Œè°ƒè¯•

1. åœ¨å®‰å“è®¾å¤‡ä¸Šå¯ç”¨å¼€å‘è€…é€‰é¡¹ï¼ˆåœ¨"è®¾ç½®"ä¸­ç‚¹å‡»"å…³äºæ‰‹æœº"ä¸­çš„"ç‰ˆæœ¬å·"7æ¬¡ï¼‰
2. å¯ç”¨USBè°ƒè¯•
3. ç¡®ä¿æ‰‹æœºå’Œç”µè„‘è¿æ¥åˆ°åŒä¸€ä¸ªWiFiç½‘ç»œ
4. åœ¨è®¾å¤‡ä¸ŠæŸ¥æ‰¾IPåœ°å€ï¼ˆé€šå¸¸åœ¨"è®¾ç½®" > "å…³äºæ‰‹æœº" > "çŠ¶æ€ä¿¡æ¯" > "IPåœ°å€"ï¼‰

#### Android 11ä»¥ä¸‹è®¾å¤‡

1. ä½¿ç”¨è„šæœ¬ç›´æ¥è¿æ¥è®¾å¤‡ï¼š
   ```bash
   ./start-dev-env.sh connect 192.168.1.100  # æ›¿æ¢ä¸ºæ‚¨è®¾å¤‡çš„IPåœ°å€
   ```

#### Android 11åŠä»¥ä¸Šè®¾å¤‡ï¼ˆéœ€è¦å…ˆé…å¯¹ï¼‰

1. å¯ç”¨æ— çº¿è°ƒè¯•é€‰é¡¹ï¼ˆåœ¨"è®¾ç½®" > "å¼€å‘è€…é€‰é¡¹" > "æ— çº¿è°ƒè¯•"ï¼‰
2. ç‚¹å‡»"ä½¿ç”¨é…å¯¹ç é…å¯¹è®¾å¤‡"é€‰é¡¹
3. è®°ä¸‹æ˜¾ç¤ºçš„é…å¯¹ç å’Œç«¯å£å·
4. ä½¿ç”¨è„šæœ¬å…ˆé…å¯¹è®¾å¤‡ï¼š
   ```bash
   ./start-dev-env.sh pair 192.168.1.100 43211 123456  # æ›¿æ¢ä¸ºæ‚¨è®¾å¤‡çš„IPã€ç«¯å£å’Œé…å¯¹ç 
   ```
5. é…å¯¹æˆåŠŸåï¼Œè¿æ¥è®¾å¤‡ï¼š
   ```bash
   ./start-dev-env.sh connect 192.168.1.100  # ä½¿ç”¨é»˜è®¤ç«¯å£5555è¿æ¥
   ```
   
   æ³¨æ„ï¼šå¦‚æœé»˜è®¤ç«¯å£æ— æ³•è¿æ¥ï¼Œæ‚¨å¯èƒ½éœ€è¦ä½¿ç”¨è®¾å¤‡æ˜¾ç¤ºçš„ç‰¹å®šç«¯å£ï¼ˆåœ¨"æ— çº¿è°ƒè¯•"ç•Œé¢æŸ¥çœ‹ï¼‰ï¼š
   ```bash
   ./start-dev-env.sh connect 192.168.1.100 37277  # ä½¿ç”¨æŒ‡å®šç«¯å£è¿æ¥
   ```

#### Apple Silicon Macä¸“ç”¨è¿æ¥æ–¹å¼

å¯¹äºApple Silicon Mac (M1/M2/M3)ç”¨æˆ·ï¼Œå¦‚æœåœ¨å®¹å™¨å†…é…å¯¹å’Œè¿æ¥è®¾å¤‡å‡ºç°é—®é¢˜ï¼ˆä¾‹å¦‚çœ‹åˆ° "rosetta error" é”™è¯¯ï¼‰ï¼Œå¯ä»¥å°è¯•ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•åœ¨ä¸»æœºä¸Šè¿›è¡Œé…å¯¹å’Œè¿æ¥ï¼š

1. é¦–å…ˆç¡®ä¿ä¸»æœºä¸Šå·²å®‰è£…ADBå·¥å…·ï¼š
   ```bash
   brew install android-platform-tools
   ```

2. å¯¹äºAndroid 11åŠä»¥ä¸Šè®¾å¤‡ï¼Œåœ¨ä¸»æœºä¸Šè¿›è¡Œé…å¯¹ï¼š
   ```bash
   ./start-dev-env.sh host-pair 192.168.1.100 43211 123456  # æ›¿æ¢ä¸ºæ‚¨è®¾å¤‡çš„IPã€ç«¯å£å’Œé…å¯¹ç 
   ```

3. ç„¶ååœ¨ä¸»æœºä¸Šè¿æ¥è®¾å¤‡ï¼š
   ```bash
   ./start-dev-env.sh host-connect 192.168.1.100  # ä½¿ç”¨é»˜è®¤ç«¯å£5555
   # æˆ–è€…
   ./start-dev-env.sh host-connect 192.168.1.100 37277  # ä½¿ç”¨æŒ‡å®šç«¯å£
   ```

4. è¿æ¥æˆåŠŸåï¼Œæ‚¨å¯ä»¥åœ¨å®¹å™¨å†…éƒ¨ä½¿ç”¨ADBå‘½ä»¤ï¼Œè®¾å¤‡è¿æ¥ç”±ä¸»æœºå’Œå®¹å™¨å…±äº«ã€‚

## é¡¹ç›®ç®¡ç†

### åˆ›å»ºæ–°é¡¹ç›®

1. åœ¨å®¹å™¨å†…æ‰“å¼€ç»ˆç«¯ï¼ˆVSCodeç»ˆç«¯æˆ–ä½¿ç”¨`./start-dev-env.sh shell`ï¼‰
2. å¯¼èˆªåˆ°projectsç›®å½•ï¼š`cd /home/developer/projects`
3. åˆ›å»ºæ–°é¡¹ç›®ï¼š
   ```bash
   # ä½¿ç”¨Android Studioå‘½ä»¤è¡Œå·¥å…·åˆ›å»ºæ–°é¡¹ç›®
   kotlin -cp $ANDROID_HOME/cmdline-tools/latest/lib/kotlin-stdlib.jar:$ANDROID_HOME/cmdline-tools/latest/lib/kotlin-reflect.jar:$ANDROID_HOME/cmdline-tools/latest/lib/* com.android.tools.idea.wizard.template.impl.projects.NewAndroidProjectKt
   
   # æˆ–è€…ä½¿ç”¨gradle
   gradle init --type kotlin-application
   ```

### å¯¼å…¥ç°æœ‰é¡¹ç›®

åªéœ€å°†é¡¹ç›®æ–‡ä»¶æ”¾åˆ°`~/android-docker-dev/projects/`ç›®å½•ä¸‹ï¼Œç„¶ååœ¨VSCodeä¸­æ‰“å¼€ã€‚

## å¸¸ç”¨å‘½ä»¤

- å¯åŠ¨ç¯å¢ƒï¼š`./start-dev-env.sh start`
- åœæ­¢ç¯å¢ƒï¼š`./start-dev-env.sh stop`
- æŸ¥çœ‹çŠ¶æ€ï¼š`./start-dev-env.sh status`
- é…å¯¹è®¾å¤‡ï¼š`./start-dev-env.sh pair è®¾å¤‡IP é…å¯¹ç«¯å£ é…å¯¹ç `ï¼ˆAndroid 11+ï¼‰
- è¿æ¥è®¾å¤‡ï¼š`./start-dev-env.sh connect è®¾å¤‡IP [ç«¯å£]`
- è¿›å…¥å®¹å™¨å‘½ä»¤è¡Œï¼š`./start-dev-env.sh shell`
- é‡å»ºå®¹å™¨ï¼š`./start-dev-env.sh build`
- æ˜¾ç¤ºå¸®åŠ©ï¼š`./start-dev-env.sh help`

### Apple Silicon Macä¸“ç”¨å‘½ä»¤

- åœ¨ä¸»æœºä¸Šé…å¯¹è®¾å¤‡ï¼š`./start-dev-env.sh host-pair è®¾å¤‡IP é…å¯¹ç«¯å£ é…å¯¹ç `
- åœ¨ä¸»æœºä¸Šè¿æ¥è®¾å¤‡ï¼š`./start-dev-env.sh host-connect è®¾å¤‡IP [ç«¯å£]`

## æ–‡ä»¶ç»“æ„

```
android-docker-dev/
â”œâ”€â”€ docker/                 # Dockerç›¸å…³é…ç½®
â”‚   â”œâ”€â”€ Dockerfile          # å®¹å™¨å®šä¹‰
â”‚   â””â”€â”€ docker-compose.yml  # å®¹å™¨ç¼–æ’é…ç½®
â”œâ”€â”€ .devcontainer/          # VSCodeå®¹å™¨å¼€å‘é…ç½®
â”‚   â””â”€â”€ devcontainer.json   # VSCodeé›†æˆé…ç½®
â”œâ”€â”€ projects/               # é¡¹ç›®ç›®å½•ï¼ˆå¯åŒ…å«å¤šä¸ªé¡¹ç›®ï¼‰
â”‚   â”œâ”€â”€ project1/           # ç¤ºä¾‹é¡¹ç›®1
â”‚   â””â”€â”€ project2/           # ç¤ºä¾‹é¡¹ç›®2
â”œâ”€â”€ start-dev-env.sh        # ç¯å¢ƒç®¡ç†è„šæœ¬
â””â”€â”€ README.md               # è¯´æ˜æ–‡æ¡£
```

## æ•…éšœæ’é™¤

### è¿æ¥è®¾å¤‡å¤±è´¥

1. ç¡®ä¿è®¾å¤‡å’Œç”µè„‘åœ¨åŒä¸€WiFiç½‘ç»œ
2. æ£€æŸ¥å®‰å“è®¾å¤‡çš„IPåœ°å€æ˜¯å¦æ­£ç¡®
3. ç¡®ä¿å·²åœ¨è®¾å¤‡ä¸Šå¯ç”¨å¼€å‘è€…é€‰é¡¹å’ŒUSBè°ƒè¯•
4. å¯¹äºAndroid 11+ï¼š
   - ç¡®ä¿å·²å¯ç”¨æ— çº¿è°ƒè¯•é€‰é¡¹
   - ç¡®ä¿å·²ä½¿ç”¨ `pair` å‘½ä»¤æ­£ç¡®é…å¯¹è®¾å¤‡
   - é…å¯¹ç ä»…åœ¨çŸ­æ—¶é—´å†…æœ‰æ•ˆï¼Œå¦‚æœé…å¯¹å¤±è´¥ï¼Œè¯·é‡æ–°è·å–æ–°çš„é…å¯¹ç 
5. åœ¨è®¾å¤‡ä¸Šæ¥å—è°ƒè¯•è¿æ¥æç¤º
6. é‡å¯ADBæœåŠ¡å™¨ï¼š
   ```bash
   ./start-dev-env.sh shell
   adb kill-server
   adb start-server
   ```
7. å¯¹äº Apple Silicon Mac (M1/M2/M3)ï¼š
   - å¦‚æœæ‚¨çœ‹åˆ°ç±»ä¼¼ `rosetta error: failed to open elf at /lib64/ld-linux-x86-64.so.2` çš„é”™è¯¯ï¼Œè¿™æ˜¯ç”±äºåœ¨ ARM æ¶æ„ä¸Šè¿è¡Œ x86_64 å®¹å™¨å¯¼è‡´çš„
   - åœ¨æŸäº›æƒ…å†µä¸‹è¿™äº›é”™è¯¯å¯èƒ½å¯¼è‡´é…å¯¹å’Œè¿æ¥åŠŸèƒ½æ— æ³•æ­£å¸¸å·¥ä½œ
   - å¦‚æœå‡ºç°è¿æ¥é—®é¢˜ï¼Œè¯·ä½¿ç”¨ `host-pair` å’Œ `host-connect` å‘½ä»¤åœ¨ä¸»æœºä¸Šç›´æ¥é…å¯¹å’Œè¿æ¥è®¾å¤‡
   - ç¡®ä¿æ‚¨çš„ä¸»æœºä¸Šå·²å®‰è£…ADBå·¥å…·ï¼ˆå¯é€šè¿‡ `brew install android-platform-tools` å®‰è£…ï¼‰
   - å¦‚æœä»æœ‰é—®é¢˜ï¼Œè¯·å°è¯•é‡å¯ Docker Desktop æˆ–è€…é‡å¯ç”µè„‘

### å®¹å™¨æ— æ³•å¯åŠ¨

1. ç¡®ä¿Docker Desktopæ­£åœ¨è¿è¡Œ
2. æ£€æŸ¥é”™è¯¯ä¿¡æ¯ï¼š`docker-compose logs`
3. å°è¯•é‡å»ºå®¹å™¨ï¼š`./start-dev-env.sh build`
